import{b as C}from"./chunk-IMZOKRP6.js";import{O as D,P as S,Y as $,a as O,c as h,f as A,g as k,i as P,k as j,m as w,o as B,q as N,s as I}from"./chunk-AJKU6CZT.js";import{a as b}from"./chunk-ORUMY5WD.js";b();b();var v={set(t,d){localStorage.setItem(t,d)},get(t){return localStorage.getItem(t)},del(t){localStorage.removeItem(t)}};var F=t=>{if(!t)return;let d=h(I,"div",{innerHTML:t,className:"tip"});setTimeout(()=>{d.addClass("hide"),setTimeout(()=>{I.removeChild(d)},300)},3e3)},re=()=>{w.auto_scroll&&v.set(S,String(B.y))},se=t=>{let d=()=>{let p=window.location.hash,c=null;if(D){v.del(S);return}if(p)try{let a=decodeURIComponent(p).substring(1);c=document.getElementById(a),!c&&t&&setTimeout(()=>{let f=document.getElementById(a);f&&C(f)},800)}catch(a){console.error("Hash decode error:",a)}else c=w.auto_scroll?parseInt(v.get(S)):0;c&&requestAnimationFrame(()=>{C(c),$(1)})};document.readyState!=="loading"?setTimeout(d,50):document.addEventListener("DOMContentLoaded",()=>{setTimeout(d,50)})},ae=(t,d)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then(()=>{d&&d(!0)},()=>{d&&d(!1)}):(console.error("Too old browser, clipborad API not supported."),d&&d(!1))};b();b();var U=()=>{let t;O.each("div.tab",d=>{if(d.getAttribute("data-ready"))return;let p=d.getAttribute("data-id"),c=d.getAttribute("data-title"),a=document.getElementById(p);a?t=!1:(a=document.createElement("div"),a.className="tabs",a.id=p,a.innerHTML='<div class="show-btn"></div>',a.querySelector(".show-btn").addEventListener("click",()=>{C(a)}),d.parentNode.insertBefore(a,d),t=!0);let f=a.querySelector(".nav ul");f||(f=h(a,"div",{className:"nav",innerHTML:"<ul></ul>"}).querySelector("ul"));let i=h(f,"li",{innerHTML:c});t&&(i.addClass("active"),d.addClass("active")),i.addEventListener("click",o=>{let x=o.currentTarget;a.find(".active").forEach(y=>{y.removeClass("active")}),d.addClass("active"),x.addClass("active")}),a.appendChild(d),d.setAttribute("data-ready",String(!0))})};var H=null,_=/mobile/i.test(window.navigator.userAgent),ye=(t,d)=>{let p={el:{},create(){t.player.options.btns&&t.player.options.btns.forEach(e=>{p.el[e]||(p.el[e]=h(t,"div",{className:e+" btn",onclick(s){t.player.fetch().then(()=>{t.player.options.events[e](s)})}}))})}},c={el:null,btns:{mode:void 0,volume:void 0},step:"next",create:()=>{if(!t.player.options.controls)return;let e=c;t.player.options.controls.forEach(s=>{if(e.btns[s])return;let r={onclick(u){e.events[s]?e.events[s](u):t.player.options.events[s](u)}};switch(s){case"volume":r.className=" "+(i.muted?"off":"on"),r.innerHTML='<div class="bar"></div>',r["on"+m.nameMap.dragStart]=e.events.volume,r.onclick=null;break;case"mode":r.className=" "+t.player.options.mode;break;default:r.className="";break}r.className=s+r.className+" btn",e.btns[s]=h(e.el,"div",r)}),e.btns.volume.bar=e.btns.volume.querySelector(".bar")},events:{mode(e){switch(t.player.options.mode){case"loop":t.player.options.mode="random";break;case"random":t.player.options.mode="order";break;default:t.player.options.mode="loop"}c.btns.mode.className="mode "+t.player.options.mode+" btn",v.set("_PlayerMode",t.player.options.mode)},volume(e){e.preventDefault();let s=e.currentTarget,r=!1,u=l=>{l.preventDefault(),t.player.volume(c.percent(l,s)),r=!0},n=l=>{l.preventDefault(),s.removeEventListener(m.nameMap.dragEnd,n),s.removeEventListener(m.nameMap.dragMove,u),r?(t.player.muted(),t.player.volume(c.percent(l,s))):i.muted?(t.player.muted(),t.player.volume(i.volume)):(t.player.muted("muted"),c.update(0))};s.addEventListener(m.nameMap.dragMove,u),s.addEventListener(m.nameMap.dragEnd,n)},backward(e){c.step="prev",t.player.mode()},forward(e){c.step="next",t.player.mode()}},update(e){c.btns.volume.className="volume "+(!i.muted&&e>0?"on":"off")+" btn",A(c.btns.volume.bar,Math.floor(e*100)+"%")},percent(e,s){let r=((e.clientX||e.changedTouches[0].clientX)-P(s))/k(s);return r=Math.max(r,0),Math.min(r,1)}},a={el:null,bar:null,create(){let e=o.current().el;e&&(a.el&&(a.el.parentNode.removeClass("current").removeEventListener(m.nameMap.dragStart,a.drag),a.el.remove()),a.el=h(e,"div",{className:"progress"}),a.el.setAttribute("data-dtime",m.secondToTime(0)),a.bar=h(a.el,"div",{className:"bar"}),e.addClass("current"),e.addEventListener(m.nameMap.dragStart,a.drag),o.scroll())},update(e){A(a.bar,Math.floor(e*100)+"%"),a.el.setAttribute("data-ptime",m.secondToTime(e*i.duration))},seeking(e){e?a.el.addClass("seeking"):a.el.removeClass("seeking")},percent(e,s){let r=((e.clientX||e.changedTouches[0].clientX)-P(s))/k(s);return r=Math.max(r,0),Math.min(r,1)},drag(e){e.preventDefault();let s=o.current().el,r=n=>{n.preventDefault();let l=a.percent(n,s);a.update(l),q.update(l*i.duration)},u=n=>{n.preventDefault(),s.removeEventListener(m.nameMap.dragEnd,u),s.removeEventListener(m.nameMap.dragMove,r);let l=a.percent(n,s);a.update(l),t.player.seek(l*i.duration),i.disableTimeupdate=!1,a.seeking(!1)};i.disableTimeupdate=!0,a.seeking(!0),s.addEventListener(m.nameMap.dragMove,r),s.addEventListener(m.nameMap.dragEnd,u)}},f={el:null,create(){let e=o.current();f.el.innerHTML='<div class="cover"><div class="disc"><img src="'+e.cover+'" class="blur"  alt="music cover"/></div></div><div class="info"><h4 class="title">'+e.name+"</h4><span>"+e.artist+'</span><div class="lrc"></div></div>',f.el.querySelector(".cover").addEventListener("click",t.player.options.events["play-pause"]),q.create(f.el.querySelector(".lrc"))}},i,o={el:null,data:[],index:-1,errnum:0,add:(e,s)=>{s.forEach(r=>{r.group=e,r.name=r.name||r.title||"Meida name",r.artist=r.artist||r.author||"Anonymous",r.cover=r.cover||r.pic,r.type=r.type||"normal",o.data.push(r)})},clear(){o.data=[],o.el.innerHTML="",o.index!==-1&&(o.index=-1,t.player.fetch())},create(){let e=o.el;o.data.map((s,r)=>{if(s.el)return null;let u="list-"+t.player._id+"-"+s.group,n=document.getElementById(u);return n||(n=h(e,"div",{id:u,className:t.player.group?"tab":"",innerHTML:"<ol></ol>"}),t.player.group&&(n.setAttribute("data-title",t.player.options.rawList[s.group].title),n.setAttribute("data-id",t.player._id))),s.el=h(n.querySelector("ol"),"li",{title:s.name+" - "+s.artist,innerHTML:'<span class="info"><span>'+s.name+"</span><span>"+s.artist+"</span></span>",onclick(l){let T=l.currentTarget;if(o.index===r&&a.el){i.paused?t.player.play():t.player.seek(i.duration*a.percent(l,T));return}t.player.switch(r),t.player.play()}}),s}),U()},current(){return this.data[this.index]},scroll(){let e=this.current(),s=this.el.querySelector("li.active");s&&s.removeClass("active");let r=this.el.querySelector(".tab.active");return r&&r.removeClass("active"),s=this.el.querySelectorAll(".nav li")[e.group],s&&s.addClass("active"),r=this.el.querySelectorAll(".tab")[e.group],r&&r.addClass("active"),C(e.el,e.el.offsetTop),this},title(){if(i.paused)return;let e=this.current();document.title="Now Playing..."+e.name+" - "+e.artist+" | "+N},error(){let e=this.current();e.el.removeClass("current").addClass("error"),e.error=!0,this.errnum++}},x={el:null,create(){this.el||(this.el=h(t,"div",{className:"player-info",innerHTML:(t.player.options.type==="audio"?'<div class="preview"></div>':"")+'<div class="controller"></div><div class="playlist"></div>'},"after"),f.el=this.el.querySelector(".preview"),o.el=this.el.querySelector(".playlist"),c.el=this.el.querySelector(".controller"))},hide(){let e=this.el;e.addClass("hide"),window.setTimeout(()=>{e.removeClass("show hide")},300)}},y={type:"audio",mode:"random",btns:["play-pause","music"],controls:["mode","backward","play-pause","forward","volume"],events:{"play-pause"(e){i.paused?t.player.play():t.player.pause()},music(e){x.el.hasClass("show")?x.hide():(x.el.addClass("show"),o.scroll().title())}}},m={random(e){return Math.floor(Math.random()*e)},parse(e){let s=[];return[["music.163.com.*song.*id=(\\d+)","netease","song"],["music.163.com.*album.*id=(\\d+)","netease","album"],["music.163.com.*artist.*id=(\\d+)","netease","artist"],["music.163.com.*playlist.*id=(\\d+)","netease","playlist"],["music.163.com.*discover/toplist.*id=(\\d+)","netease","playlist"],["y.qq.com.*song/(\\w+)(.html)?","tencent","song"],["y.qq.com.*album/(\\w+)(.html)?","tencent","album"],["y.qq.com.*singer/(\\w+)(.html)?","tencent","artist"],["y.qq.com.*playsquare/(\\w+)(.html)?","tencent","playlist"],["y.qq.com.*playlist/(\\w+)(.html)?","tencent","playlist"],["xiami.com.*song/(\\w+)","xiami","song"],["xiami.com.*album/(\\w+)","xiami","album"],["xiami.com.*artist/(\\w+)","xiami","artist"],["xiami.com.*collect/(\\w+)","xiami","playlist"]].forEach(r=>{let n=new RegExp(r[0]).exec(e);n!==null&&(s=[r[1],r[2],n[1]])}),s},fetch(e){let s=[];return new Promise((r,u)=>{e.forEach(n=>{let l=m.parse(n);if(l[0]){let T=JSON.stringify(l),M=v.get(T);M?(s.push(...JSON.parse(M)),r(s)):fetch(`${w.playerAPI}/meting/?server=`+l[0]+"&type="+l[1]+"&id="+l[2]+"&r="+Math.random()).then(g=>g.json()).then(g=>{v.set(T,JSON.stringify(g)),s.push(...g),r(s)}).catch(g=>{})}else s.push(n),r(s)})})},secondToTime(e){let s=l=>isNaN(l)?"00":l<10?"0"+l:""+l,r=Math.floor(e/3600),u=Math.floor((e-r*3600)/60),n=Math.floor(e-r*3600-u*60);return(r>0?[r,u,n]:[u,n]).map(s).join(":")},nameMap:{dragStart:_?"touchstart":"mousedown",dragMove:_?"touchmove":"mousemove",dragEnd:_?"touchend":"mouseup"}};i=null,t.player={_id:m.random(999999),group:!0,load(e){let s="";e&&e.length>0?this.options.rawList!==e&&(this.options.rawList=e,o.clear(),this.fetch()):(s="none",this.pause());for(let r in p.el)j(p.el[r],s);return this},fetch(){return new Promise((e,s)=>{if(o.data.length>0)e(!1);else if(this.options.rawList){let r=[];this.options.rawList.forEach((u,n)=>{r.push(new Promise((l,T)=>{let M=n,g;u.list?(this.group=!0,g=u.list):(M=0,this.group=!1,g=[u]),m.fetch(g).then(L=>{o.add(M,L),l(0)})}))}),Promise.all(r).then(()=>{e(!0)})}}).then(e=>{e&&(o.create(),c.create(),this.mode())})},mode(){let e=o.data.length;if(!e||o.errnum===e)return;let s=c.step==="next"?1:-1,r=()=>{let n=o.index+s;(n>e||n<0)&&(n=c.step==="next"?0:e-1),o.index=n},u=()=>{let n=m.random(e);o.index!==n?o.index=n:r()};switch(this.options.mode){case"random":u();break;case"order":r();break;case"loop":c.step&&r(),o.index===-1&&u();break}this.init()},switch(e){typeof e=="number"&&e!==o.index&&o.current()&&!o.current().error&&(o.index=e,this.init())},init(){let e=o.current();if(!e||e.error){this.mode();return}let s=!1;i.paused||(s=!0,this.stop()),i.setAttribute("src",e.url),i.setAttribute("title",e.name+" - "+e.artist),this.volume(v.get("_PlayerVolume")||"0.7"),this.muted(v.get("_PlayerMuted")),a.create(),this.options.type==="audio"&&f.create(),s===!0&&this.play()},play(){if(H&&H.player.pause(),o.current().error){this.mode();return}i.play().then(()=>{o.scroll()}).catch(e=>{})},pause(){i.pause(),document.title=N},stop(){i.pause(),i.currentTime=0,document.title=N},seek(e){e=Math.max(e,0),e=Math.min(e,i.duration),i.currentTime=e,a.update(e/i.duration)},muted(e){e==="muted"?(i.muted=e,v.set("_PlayerMuted",e),c.update(0)):(v.del("_PlayerMuted"),i.muted=!1,c.update(i.volume))},volume(e){isNaN(e)||(c.update(e),v.set("_PlayerVolume",e),i.volume=e)},mini(){x.hide()}};let q={el:null,data:null,index:0,create(e){let s=o.index,r=o.current().lrc,u=n=>{if(s!==o.index)return;this.data=this.parse(n);let l="";this.data.forEach((T,M)=>{l+="<p"+(M===0?' class="current"':"")+">"+T[1]+"</p>"}),this.el=h(e,"div",{className:"inner",innerHTML:l},"replace"),this.index=0};r.startsWith("http")?this.fetch(r,u):u(r)},update(e){if(this.data&&(this.index>this.data.length-1||e<this.data[this.index][0]||!this.data[this.index+1]||e>=this.data[this.index+1][0])){for(let s=0;s<this.data.length;s++)if(e>=this.data[s][0]&&(!this.data[s+1]||e<this.data[s+1][0])){this.index=s;let r=-(this.index-1);this.el.style.transform="translateY("+r+"rem)",this.el.getElementsByClassName("current")[0].removeClass("current"),this.el.getElementsByTagName("p")[s].addClass("current")}}},parse(e){if(e){e=e.replace(/([^\]^\n])\[/g,(n,l)=>l+`
[`);let s=e.split(`
`),r=[],u=s.length;for(let n=0;n<u;n++){let l=s[n].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g),T=s[n].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").trim();if(l){let M=l.length;for(let g=0;g<M;g++){let L=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(l[g]),G=L[1]*60,J=parseInt(L[2]),X=L[4]?parseInt(L[4])/((L[4]+"").length===2?100:1e3):0,R=G+J+X;r.push([R,T])}}}return r=r.filter(n=>n[1]),r.sort((n,l)=>n[0]-l[0]),r}else return[]},fetch(e,s){fetch(e).then(r=>r.text()).then(r=>{s(r)}).catch(r=>{})}},W={onerror(){o.error(),t.player.mode()},ondurationchange(){i.duration!==1&&a.el.setAttribute("data-dtime",m.secondToTime(i.duration))},onloadedmetadata(){t.player.seek(0),a.el.setAttribute("data-dtime",m.secondToTime(i.duration))},onplay(){t.parentNode.addClass("playing"),F(this.getAttribute("title")),H=t},onpause(){t.parentNode.removeClass("playing"),H=null},ontimeupdate(){this.disableTimeupdate||(a.update(this.currentTime/this.duration),q.update(this.currentTime))},onended(e){t.player.mode(),t.player.play()}};return(e=>{t.player.created||(t.player.options=Object.assign(y,e),t.player.options.mode=v.get("_PlayerMode")||t.player.options.mode,p.create(),i=h(t,t.player.options.type,W),x.create(),t.parentNode.addClass(t.player.options.type),t.player.created=!0)})(d),t};b();var Te=t=>{let{text:d,parentNode:p,id:c,className:a,type:f,src:i,dataset:o}=t,x=d||t.textContent||t.innerHTML||"";p.removeChild(t);let y=document.createElement("script");c&&(y.id=c),a&&(y.className=a),f&&(y.type=f),i&&(y.src=i,y.async=!1),o.pjax!==void 0&&(y.dataset.pjax=""),x!==""&&y.appendChild(document.createTextNode(x)),p.appendChild(y)};b();var Y=(t,d)=>{let p=w[t][d].url;return p.startsWith("https")?p:p.startsWith("http")?(console.warn(`Upgrade vendor ${t}/${d} to HTTPS, Please use HTTPS url instead of HTTP url.`),p.replace("http","https")):`/${p}`};var Se=(t,d)=>{if(!window["css"+t]&&LOCAL[t]){let p={rel:"stylesheet",href:Y("css",t)},c=w.css[t];c.local||(p.integrity=c.sri,p.crossOrigin="anonymous"),h(document.head,"link",p),window["css"+t]=!0}};export{v as a,F as b,re as c,se as d,ae as e,U as f,ye as g,Te as h,Se as i};
